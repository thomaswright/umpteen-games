// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Decco from "@rescript-labs/decco/src/Decco.res.mjs";
import * as React from "react";
import * as Common from "./Common.res.mjs";
import * as Spider from "./games/Spider.res.mjs";
import * as Js_dict from "rescript/lib/es6/js_dict.js";
import * as Js_json from "rescript/lib/es6/js_json.js";
import * as FreeCell from "./games/FreeCell.res.mjs";
import * as Klondike from "./games/Klondike.res.mjs";
import * as UpAndDown from "./games/UpAndDown.res.mjs";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as DoubleFreeCell from "./games/DoubleFreeCell.res.mjs";
import * as JsxRuntime from "react/jsx-runtime";

function gameString(a) {
  return a;
}

function state_encode(value) {
  return Js_dict.fromArray([
              [
                "klondike",
                (function (extra) {
                      return Decco.arrayToJson(Klondike.Game.state_encode, extra);
                    })(value.klondike)
              ],
              [
                "freeCell",
                (function (extra) {
                      return Decco.arrayToJson(FreeCell.Game.state_encode, extra);
                    })(value.freeCell)
              ],
              [
                "doubleFreeCell",
                (function (extra) {
                      return Decco.arrayToJson(DoubleFreeCell.Game.state_encode, extra);
                    })(value.doubleFreeCell)
              ],
              [
                "upAndDown",
                (function (extra) {
                      return Decco.arrayToJson(UpAndDown.Game.state_encode, extra);
                    })(value.upAndDown)
              ],
              [
                "spider",
                (function (extra) {
                      return Decco.arrayToJson(Spider.Game.state_encode, extra);
                    })(value.spider)
              ]
            ]);
}

function state_decode(value) {
  var dict = Js_json.classify(value);
  if (typeof dict !== "object") {
    return Decco.error(undefined, "Not an object", value);
  }
  if (dict.TAG !== "JSONObject") {
    return Decco.error(undefined, "Not an object", value);
  }
  var dict$1 = dict._0;
  var extra = Belt_Option.getWithDefault(Js_dict.get(dict$1, "klondike"), null);
  var klondike = Decco.arrayFromJson(Klondike.Game.state_decode, extra);
  if (klondike.TAG === "Ok") {
    var extra$1 = Belt_Option.getWithDefault(Js_dict.get(dict$1, "freeCell"), null);
    var freeCell = Decco.arrayFromJson(FreeCell.Game.state_decode, extra$1);
    if (freeCell.TAG === "Ok") {
      var extra$2 = Belt_Option.getWithDefault(Js_dict.get(dict$1, "doubleFreeCell"), null);
      var doubleFreeCell = Decco.arrayFromJson(DoubleFreeCell.Game.state_decode, extra$2);
      if (doubleFreeCell.TAG === "Ok") {
        var extra$3 = Belt_Option.getWithDefault(Js_dict.get(dict$1, "upAndDown"), null);
        var upAndDown = Decco.arrayFromJson(UpAndDown.Game.state_decode, extra$3);
        if (upAndDown.TAG === "Ok") {
          var extra$4 = Belt_Option.getWithDefault(Js_dict.get(dict$1, "spider"), null);
          var spider = Decco.arrayFromJson(Spider.Game.state_decode, extra$4);
          if (spider.TAG === "Ok") {
            return {
                    TAG: "Ok",
                    _0: Decco.unsafeAddFieldToObject("klondike", klondike._0, Decco.unsafeAddFieldToObject("freeCell", freeCell._0, Decco.unsafeAddFieldToObject("doubleFreeCell", doubleFreeCell._0, Decco.unsafeAddFieldToObject("upAndDown", upAndDown._0, Decco.unsafeAddFieldToObject("spider", spider._0, {})))))
                  };
          }
          var e = spider._0;
          return {
                  TAG: "Error",
                  _0: {
                    path: ".spider" + e.path,
                    message: e.message,
                    value: e.value
                  }
                };
        }
        var e$1 = upAndDown._0;
        return {
                TAG: "Error",
                _0: {
                  path: ".upAndDown" + e$1.path,
                  message: e$1.message,
                  value: e$1.value
                }
              };
      }
      var e$2 = doubleFreeCell._0;
      return {
              TAG: "Error",
              _0: {
                path: ".doubleFreeCell" + e$2.path,
                message: e$2.message,
                value: e$2.value
              }
            };
    }
    var e$3 = freeCell._0;
    return {
            TAG: "Error",
            _0: {
              path: ".freeCell" + e$3.path,
              message: e$3.message,
              value: e$3.value
            }
          };
  }
  var e$4 = klondike._0;
  return {
          TAG: "Error",
          _0: {
            path: ".klondike" + e$4.path,
            message: e$4.message,
            value: e$4.value
          }
        };
}

var state = {
  contents: {
    klondike: [],
    freeCell: [],
    doubleFreeCell: [],
    upAndDown: [],
    spider: []
  }
};

function setState(f) {
  var newState = f(state.contents);
  state.contents = newState;
  localStorage.setItem("state", JSON.stringify(state_encode(newState)));
}

function useForceUpdate() {
  var match = React.useState(function () {
        return 0;
      });
  var setValue = match[1];
  return function () {
    setValue(function (value) {
          return value + 1 | 0;
        });
  };
}

function GameBrowser(props) {
  var match = Common.useLocalStorage("gametype", "Klondike");
  var setSelectGameType = match[1];
  var selectGameType = match[0];
  var forceUpdate = useForceUpdate();
  var match$1 = React.useState(function () {
        return false;
      });
  var setLoaded = match$1[1];
  React.useEffect((function () {
          var s = localStorage.getItem("state");
          if (s !== null) {
            var d = state_decode(JSON.parse(s));
            if (d.TAG === "Ok") {
              state.contents = d._0;
            }
            
          } else {
            setState(function (x) {
                  return x;
                });
          }
          setLoaded(function (param) {
                return true;
              });
          forceUpdate();
        }), []);
  if (!match$1[0]) {
    return null;
  }
  var tmp;
  switch (selectGameType) {
    case "Klondike" :
        tmp = JsxRuntime.jsx(Klondike.Game.make, {
              getState: state.contents.klondike.length === 0 ? undefined : (function () {
                    return state.contents.klondike[0];
                  }),
              setState: (function (f) {
                  setState(function (state) {
                        return {
                                klondike: Common.ArrayAux.update(state.klondike, 0, f),
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                }),
              onCreateNewGame: (function (x) {
                  setState(function (state) {
                        return {
                                klondike: [x].concat(state.klondike),
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                  forceUpdate();
                })
            }, "klondike" + state.contents.klondike.length.toString());
        break;
    case "Free Cell" :
        tmp = JsxRuntime.jsx(FreeCell.Game.make, {
              getState: state.contents.freeCell.length === 0 ? undefined : (function () {
                    return state.contents.freeCell[0];
                  }),
              setState: (function (f) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: Common.ArrayAux.update(state.freeCell, 0, f),
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                }),
              onCreateNewGame: (function (x) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: [x].concat(state.freeCell),
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                  forceUpdate();
                })
            }, "freeCell" + state.contents.freeCell.length.toString());
        break;
    case "2 Deck Free Cell" :
        tmp = JsxRuntime.jsx(DoubleFreeCell.Game.make, {
              getState: state.contents.doubleFreeCell.length === 0 ? undefined : (function () {
                    return state.contents.doubleFreeCell[0];
                  }),
              setState: (function (f) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: Common.ArrayAux.update(state.doubleFreeCell, 0, f),
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                }),
              onCreateNewGame: (function (x) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: [x].concat(state.doubleFreeCell),
                                upAndDown: state.upAndDown,
                                spider: state.spider
                              };
                      });
                  forceUpdate();
                })
            }, "doubleFreeCell" + state.contents.doubleFreeCell.length.toString());
        break;
    case "Up & Down" :
        tmp = JsxRuntime.jsx(UpAndDown.Game.make, {
              getState: state.contents.upAndDown.length === 0 ? undefined : (function () {
                    return state.contents.upAndDown[0];
                  }),
              setState: (function (f) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: Common.ArrayAux.update(state.upAndDown, 0, f),
                                spider: state.spider
                              };
                      });
                }),
              onCreateNewGame: (function (x) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: [x].concat(state.upAndDown),
                                spider: state.spider
                              };
                      });
                  forceUpdate();
                })
            }, "upAndDown" + state.contents.upAndDown.length.toString());
        break;
    case "One Suit Spider" :
        tmp = JsxRuntime.jsx(Spider.Game.make, {
              getState: state.contents.spider.length === 0 ? undefined : (function () {
                    return state.contents.spider[0];
                  }),
              setState: (function (f) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: Common.ArrayAux.update(state.spider, 0, f)
                              };
                      });
                }),
              onCreateNewGame: (function (x) {
                  setState(function (state) {
                        return {
                                klondike: state.klondike,
                                freeCell: state.freeCell,
                                doubleFreeCell: state.doubleFreeCell,
                                upAndDown: state.upAndDown,
                                spider: [x].concat(state.spider)
                              };
                      });
                  forceUpdate();
                })
            }, "spider" + state.contents.spider.length.toString());
        break;
    
  }
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsxs("div", {
                      children: [
                        JsxRuntime.jsx("div", {
                              children: "tom & won's card games",
                              className: "mb-1 text-white font-medium tracking-widest "
                            }),
                        JsxRuntime.jsx("div", {
                              children: [
                                  "Klondike",
                                  "Free Cell",
                                  "2 Deck Free Cell",
                                  "Up & Down",
                                  "One Suit Spider"
                                ].map(function (v) {
                                    var selected = v === selectGameType;
                                    return JsxRuntime.jsx("button", {
                                                children: v,
                                                className: [
                                                    selected ? "text-amber-500 underline" : "text-white",
                                                    "font-black"
                                                  ].join(" "),
                                                onClick: (function (param) {
                                                    setSelectGameType(function (param) {
                                                          return v;
                                                        });
                                                  })
                                              }, v);
                                  }),
                              className: "flex flex-row gap-5 text-xl"
                            })
                      ],
                      className: "px-5 pt-3"
                    }),
                tmp
              ],
              className: " bg-gradient-to-tl from-green-900 to-green-700 h-dvh"
            });
}

var make = GameBrowser;

export {
  gameString ,
  state_encode ,
  state_decode ,
  state ,
  setState ,
  useForceUpdate ,
  make ,
}
/* react Not a pure module */
